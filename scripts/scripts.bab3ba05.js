(function(){var a,d,g,h,f,e,l;l=function(){return function(){return"angular-loading-bar angularPopupBoxes ngAnimate ngCookies ngResource ngRoute ngSanitize ngTouch oauth restangular ui.bootstrap ui.router ui.select validation validation.rule validation.schema".split(" ")}}();h=function(){return function(b,c,m){b.hashPrefix("!");c.otherwise("/");m.strictMode(!1)}}();d=function(){return function(b){b.setDefaultHttpFields({cache:!1});b.addResponseInterceptor(function(c,b){var k;"getList"===b&&angular.isObject(c)?
(k=angular.copy(c.content,k),delete c.content,k.meta=c):k=c;return k})}}();e=function(){return function(b){b.showSuccessMessage=!1;b.invalidCallback=function(c){return $(c).parents(".form-group:first").addClass("has-error")};b.validCallback=function(c){return $(c).parents(".form-group:first").removeClass("has-error")};b.setExpression({match:function(c,b,k,f,a){return c===$(a).val()},alphanumeric:/^[a-z0-9]+$/i});b.setErrorHTML(function(c){return'<p class="text-danger">'+c+"</p>"});b.setSuccessHTML(function(c){return'<p class="text-success">'+
c+"</p>"})}}();f=function(){return function(b,c){b.setExpression({userexist:function(b){return c.one(b).get().then(function(c){return!c},function(){return!0})}})}}();g=function(){return function(b){b.theme="bootstrap";b.resetSearchInput=!0}}();a=function(){return function(b,c,a){b.$state={};c.isAuthorized()?b.currentUser||a.one("me").get().then(function(c){return b.currentUser=c}):c.login();b.$on("oauth:unauthorized",function(){return c.login()});b.$on("oauth:logout",function(){return c.login()});
b.$on("$stateChangeStart",function(a,f,m){if(!c.isAuthorized())return a.preventDefault(),b.$state.toState=f,b.$state.toState.params=m,c.login()})}}();angular.module("yamaAdminApp",new l).config(["$locationProvider","$urlRouterProvider","$urlMatcherFactoryProvider",h]).config(["RestangularProvider",d]).config(["$validationProvider",e]).run(["$validation","RestUserService",f]).config(["uiSelectConfig",g]).run(["$rootScope","oauth","RestUserService",a])}).call(this);
(function(){var a;a=function(){return function(a){this.menus=[{menu:"Users",icon:"user",ref:"app.admin.user"},{menu:"Roles",icon:"users",ref:"app.admin.role"}];this.state=a;this.state.go(this.menus[0].ref)}}();angular.module("yamaAdminApp").controller("adminController",["$state",a]);"use strict";a=function(){return function(a){a.state("app.admin",{url:"admin",templateUrl:"admin/admin.html",controller:"adminController as ctrl"})}}();angular.module("yamaAdminApp").config(["$stateProvider",a])}).call(this);
(function(){var a;a=function(){return function(a){return a.service("roles")}}();angular.module("yamaAdminApp").factory("RestRoleService",["Restangular",a])}).call(this);
(function(){var a,d,g,h;a=function(){return function(a,e,g,b){var c;c=this;c.searchParams=e.search();c.searchParams.hash=0;c.page=1;this.search=function(){c.searchParams.hash++;c.searchParams.page=0;e.search(c.searchParams);return g.getList(c.searchParams).then(function(b){var a,f,e,g,d;c.users=b;c.page=b.meta.number+1;a=function(c){return c.getList("roles").then(function(b){return c.roles=b})};d=[];e=0;for(g=b.length;e<g;e++)f=b[e],d.push(a(f));return d})};this.search();this.openForm=function(b){return a.open({templateUrl:"admin/user/user.form.html",
controller:"userFormController as ctrl",size:"md",resolve:{user:function(){return b||{}}}}).result.then(function(b){c.searchParams.q=b.username;return c.search()})};this.changePasswd=function(b){return a.open({templateUrl:"admin/user/user.passwd.html",controller:"userChangePasswdFormController as ctrl",size:"md",resolve:{user:function(){return b}}}).result.then(function(){return c.search()})};this.addRole=function(b){return a.open({templateUrl:"admin/user/user.role.html",controller:"userEditRoleFormController as ctrl",
size:"md",resolve:{user:function(){return b}}}).result.then(function(){return c.search(c.searchParams)})};this.remove=function(a){return b.confirm("Are you sure want to delete this data?").result.then(function(){return a.remove().then(function(){return c.search(c.searchParams)})})}}}();h=function(){return function(a,e,g,b){var c,d,k;c=this;c.roles=[];if(c.user=b)b.confirmPassword=b.password;k=function(b){return a.close(b)};d=function(){return c.error=!0};this.submit=function(b,a){return e.validate(a).success(function(){c.error=
!1;return b.id?b.put().then(k,d):g.post(b).then(k,d)})}}}();d=function(){return function(a,e,g){var b;g.password="";b=this;b.user=g;this.submit=function(c,g){return e.validate(g).success(function(){b.error=!1;return c.post("password").then(function(){return a.close()},function(){return b.error=!0})})}}}();g=function(){return function(a,g,d,b){var c,h;c=this;c.user=b;c.roles=[];h=function(){return g.get("$http").remove(b.one("roles").getRequestedUrl())};this.loadRoles=function(b){return d.getList({q:b}).then(function(b){return c.roles=
b})};this.addRole=function(c){return b.one("roles",c.id).put().then(h)};this.removeRole=function(c){return b.one("roles",c.id).remove().then(h)};this.done=a.close}}();angular.module("yamaAdminApp").controller("userController",["$modal","$location","RestUserService","angularPopupBoxes",a]).controller("userFormController",["$modalInstance","$validation","RestUserService","user",h]).controller("userChangePasswdFormController",["$modalInstance","$validation","user",d]).controller("userEditRoleFormController",
["$modalInstance","$cacheFactory","RestRoleService","user",g]);"use strict";a=function(){return function(a){a.state("app.admin.user",{url:"/user",templateUrl:"admin/user/user.list.html",controller:"userController as ctrl"})}}();angular.module("yamaAdminApp").config(["$stateProvider",a]);"use strict";a=function(){return function(a){return a.service("users")}}();angular.module("yamaAdminApp").factory("RestUserService",["Restangular",a]);"use strict";a=function(){return function(a){a.set("user",{username:{validations:"required, minlength=6, userexist, alphanumeric",
"validate-on":"blur",messages:{required:{error:"Username cannot be blank",success:"Ok"},minlength:{error:"Must be longer than 5 character",success:"Ok"},userexist:{error:"Username already exist",success:"Ok"},alphanumeric:{error:"Only alphanumeric are allowed",success:"Ok"}}},passwd:{validations:"required","validate-on":"blur",messages:{required:{error:"Password cannot be blank",success:"Ok"}}},confpasswd:{validations:'match=[name="passwd"]',"validate-on":"blur",messages:{match:{error:"Password and confirm password did not match",
success:"Ok"}}},firstname:{validations:"required","validate-on":"blur",messages:{required:{error:"First name cannot be blank",success:"Ok"}}},lastname:{validations:"required","validate-on":"blur",messages:{required:{error:"Last name cannot be blank",success:"Ok"}}},email:{validations:"required, email, userexist","validate-on":"blur",messages:{required:{error:"First name cannot be blank",success:"Ok"},email:{error:"Not a valid email address",success:"Ok"},userexist:{error:"Email address already exist",
success:"Ok"}}}});a.set("passwd",{passwd:{validations:"required, minlength=6","validate-on":"blur",messages:{required:{error:"Password cannot be blank",success:"Ok"},minlength:{error:"Must be longer than 5 character",success:"Ok"}}},confpasswd:{validations:'match=[name="passwd"]',"validate-on":"blur",messages:{match:{error:"Password and confirm password did not match",success:"Ok"}}}})}}();angular.module("yamaAdminApp").config(["validationSchemaProvider",a])}).call(this);
(function(){var a;a=function(){return function(a,g,h){a.go("app.admin")}}();angular.module("yamaAdminApp").controller("appController",["$state","$rootScope","$timeout",a]);"use strict";a=function(){return function(a){a.state("app",{url:"/",templateUrl:"app/app.html",controller:"appController as ctrl"})}}();angular.module("yamaAdminApp").config(["$stateProvider",a])}).call(this);
(function(){var a,d;d=function(){return function(a,d,f){return{request:function(a){f.get()&&(a.headers.Authorization="Bearer "+f.get().access_token);return a},responseError:function(e){401===e.status&&a.$broadcast("oauth:unauthorized",e);return d.reject(e)}}}}();a=function(){return function(a){a.interceptors.push("OauthInterceptor")}}();angular.module("yamaAdminApp").factory("OauthInterceptor",["$rootScope","$q","AccessToken",d]).config(["$httpProvider",a]);"use strict";a=function(){return function(){var a,
d,f,e,l,b,c,m;b=l=f=e=d=a=null;c={clientId:"",redirectUri:location.protocol+"//"+location.host,site:location.protocol+"//"+location.host,authorizePath:"/oauth/authorize",tokenPath:"/oauth/token",responseType:"token",state:null,scope:null,storage:"sessionStorage"};m=function(c){a=c.get("$rootScope");d=c.get("$timeout");e=c.get("Endpoint");f=c.get("AccessToken");l=c.get("Storage");l.use(b.storage);e.set(b);f.set(b);return a.$on("oauth:expired",function(){return f.destroy()})};this.configure=function(a){if(!(a instanceof
Object))throw new TypeError("Config must be object");return b=angular.extend({},c,a)};this.login=function(){f.destroy();return e.redirect()};this.logout=function(){f.destroy();return d(function(){return a.$broadcast("oauth:logout")},500)};this.isAuthorized=function(){return!(null===f.get()||f.expired())};this.getAccessToken=function(){return f.get()};this.isExpired=function(){return f.expired()};this.$get=["$injector",function(a){m(a);return{login:this.login,logout:this.logout,isAuthorized:this.isAuthorized,
getAccessToken:this.getAccessToken,isExpired:this.isExpired}}]}}();angular.module("yamaAdminApp").provider("oauth",[a])}).call(this);
(function(){var a,d;a=function(){return function(a){a.configure({site:"http://yama2.meruvian.org",scope:"read write",clientId:"ca4bde63-9a81-4202-b869-69041f5d9217",redirectUri:"http://dianw.github.io/yama-admin"})}}();d=function(){return function(a){a.setBaseUrl("http://yama2.meruvian.org/api")}}();angular.module("yamaAdminApp").config(["oauthProvider",a]).config(["RestangularProvider",d])}).call(this);
